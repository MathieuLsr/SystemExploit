// Include pour ma lib perso
#include "../../headers/gestionFichiers.h"

// Include pour printf
#include <stdio.h>

#include <string.h>

// Include pour les process
#include <unistd.h> // pipe
#include <sys/types.h>

#include <fcntl.h>

// Include pour Wait
#include <sys/wait.h>

// Pour Exit
#include <stdlib.h>

// Pour errno
#include <errno.h>

// Pour signal (kill ici)
#include <signal.h>

#define READ 0 
#define WRITE 1 

int main(int argc, char const *argv[])
{
    
    printf("Lancement test3...\n") ; 

    int pid = fork() ;

    if(pid == 0){

        sleep(10) ;
        kill(getppid(), SIGINT) ;
        printf("Trop tard : coffre-fort fermé.\n") ;
        exit(0) ;

    }
    
    if(pid > 0) {

        printf("Saisissez le code secret : \n") ;
        char* text = getAllText(0) ;
        char* pwd = "1234" ;
        int result = strncmp(text, pwd, 4) ;

        if(result == 0){
                printf("Bravo : coffre-fort ouvert.\n") ;
                kill(pid, SIGINT) ;
                exit(1) ;
        }

        printf("Code faux : coffre-fort fermé.\n") ;
        kill(pid, SIGINT) ;
        exit(0) ;

    }

    return 0;
}
