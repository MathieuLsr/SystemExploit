#include "../headers/gestionFichiers.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h> // Include pour strlen

//Include pour Read
#include <sys/types.h>
#include <sys/uio.h> 
#include <unistd.h>

int TAILLEBUF = 100 ; // Taille d'une ligne
int TAILLEMAXFILE = 100000 ; // Taille d'un fichier txt

char* litDixCaracteres(int descriptor){
    int count = 10 ; 
    char* buf = malloc((count+1)*sizeof(char)); 
    buf[count] = '\0' ;
    // Use pread pour pas modifier le pointeur
    read(descriptor, buf, count);
    return buf ;
}

char* litLigne(int descriptor){
    int i = 0;
    char *c = malloc(TAILLEBUF+1);
    do {
        //    usleep(1); // à decommenter pour bien voir le problème de la question II-B-3 et sa résolution en II-C
        if( (read(descriptor, &c[i],1) <= 0) || (i == TAILLEBUF)){
            free(c);
            return NULL;
        }
        i++;
    } while(c[i-1] != '\n');
    c[i] = '\0';
    return c;
}

char* getAllText(int descriptor){
    char* buf = malloc((TAILLEMAXFILE+1)*sizeof(char)); 
    buf[TAILLEMAXFILE] = '\0' ;
    // Use pread pour pas modifier le pointeur
    ssize_t t = read(descriptor, buf, TAILLEMAXFILE);
    char* tab = malloc(t) ;

    for(int i=0 ; i<t ; i++) tab[i] = buf[i] ;

    //printf(">> %zd\n", t) ;
    return tab ;

}

int clearFile(int fd){
    char* c ;
    int i = read(fd, c, 1) ;
    printf("%d", i) ;
    while(i > 0){
        write(fd, NULL, 1) ;
        printf("Write null...") ;
    }
    return 1 ;
}

int getNombreLigne(int descriptor){
    char* buf = malloc((TAILLEMAXFILE+1)*sizeof(char)); 
    buf[TAILLEMAXFILE] = '\0' ;
    // Use pread pour pas modifier le pointeur
    ssize_t t = read(descriptor, buf, TAILLEMAXFILE);

    int i = t/TAILLEBUF ;
    printf(">> ssize_t : %zd\n", t) ;
    printf(">> t / taillebuf : %d\n", i) ;

    if(i*TAILLEBUF != t) i++ ;

    return i ;

}

int ecritLigne(int fd, char *c) {
  int taille = strlen(c);
  if(write(fd, c, taille) == taille) return 1;
  else return 0;
}

void afficheTab(char* tab){
    printf("%s\n", tab) ;
}
