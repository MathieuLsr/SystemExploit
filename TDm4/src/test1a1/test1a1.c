// Include pour ma lib perso
#include "../../headers/gestionFichiers.h"

// Include pour printf
#include <stdio.h>

#include <string.h>

// Include pour les process
#include <unistd.h> // pipe
#include <sys/types.h>

#include <fcntl.h>

// Include pour Wait
#include <sys/wait.h>

// Pour Exit
#include <stdlib.h>

// Pour errno
#include <errno.h>

// Pour les Threads
#include <pthread.h>

char* c ; 

void* ThreadServer(){

    printf("Salut Server\n") ;

    char* path = "/Users/mathieulesur/Downloads/ESIEE/3ème Année/System Exploit/TDm4/src/test1a1/outputStream.txt" ;
    int fd = open(path, O_WRONLY|O_CREAT, S_IRUSR) ;

    while(c == NULL) ; 

    printf("Text Server : %s", c) ;
    ecritLigne(fd, c) ;
    return NULL;
}

void* ThreadClient(){
    
    printf("Salut Client\n") ;

    char* path = "/Users/mathieulesur/Downloads/ESIEE/3ème Année/System Exploit/TDm4/src/test1a1/inputStream.txt" ;
    int fd = open(path, O_RDONLY) ;

    c = getAllText(fd) ;
    printf("C = %s\n", c) ;
    return NULL;
}

int main()
{
    
    printf("Lancement test1a1...\n") ; 

    pthread_t client, server ; 
    int iclient, iserver ;


    iserver = pthread_create(&server, NULL, ThreadServer, NULL);
    if (iserver){
        printf("ERROR : pthread_create() is %d\n", iserver);
        exit(-1);
    }

    iclient = pthread_create(&client, NULL, ThreadClient, NULL);
    if (iclient){
        printf("ERROR : pthread_create() is %d\n", iclient);
        exit(-1);
    }

    pthread_join(server, NULL) ;
    pthread_join(client, NULL) ;


    return 0;
}

